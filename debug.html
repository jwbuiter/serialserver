<html>
<head>
  <title>MBDCcomUnit</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box;}
      body { font-style: : Helvetica, Arial; font-size: 0px;}
      table { width: 100%; text-align: center; border: none; border-collapse: collapse;}
      tr { height: 30px; }
      td { text-align: center; font-size: 20px; border-style: bold; }
      .header { background-color: yellow;}
      .result { background-color: #98FB98;}
      .buttons {position: fixed; right: 0; top: 30px;}
    </style>
</head>
<body>
  <table id="table">
    <tr>
      <td class="header" id="headername"></td>
      <td class="header" id="headerip"></td>
      <td class="header" id="headertime"></td>
      <td class="header" id="headerdate"></td>
      <td class="header" id="headerqs"></td>
    </tr>
  </table>
  <div class = "buttons">
    <img src = "/shutdown.ico" height="30" width="30" onclick="javascript:goShutdown()">
    <img src = "/settings.svg" height="30" width="30" onclick="javascript:goSettings()">
    <img src = "/restart.ico"  height="30" width="30" onclick="javascript:goRestart()">
    <img src = "/terminal.png" height="30" width="30" onclick="javascript:goTerminal()">
    </a>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="/config.js"></script>
  <script>
    function goSettings(){
      if (confirm("Do you want to go to the settings?")){
        window.location.href = '/settings'; //relative to domain
      }
    }

    function goShutdown(){
      if (confirm("Do you really want to shut down?")){
        window.location.href = '/shutdown'; //relative to domain
      }
    }

    function goRestart(){
      if (confirm("Do you really want to restart?")){
        window.location.href = '/restart'; //relative to domain
      }
    }

    function goTerminal(){
      if (confirm("Do you really want to open a terminal?")){
        window.location.href = '/terminal'; //relative to domain
      }
    }

    function printDate(){
      var date = new Date();
      return date.getDate() + '-' + (date.getMonth()+1) + '-' + (date.getYear()+1900);
    }
    function printTime(){
      var date = new Date();
      return date.getHours() + ':' + ("0" + date.getMinutes()).slice(-2) + ':' + ("0" + date.getSeconds()).slice(-2);
    }

    $('#headername').html(config.name); 
    $('#headerdate').html(printDate());
    $('#headertime').html(printTime());
    $('#headerqs').html(config.QS);

    setInterval(function(){ 
      $('#headerdate').html(printDate());
      $('#headertime').html(printTime());
    }, 1000);

    for (var i = 0; i<config.serial.length; i++){
      $('#table').append($('<tr>'));

      for (var j = 0; j<config.serial[i].entries; j++){
        var row = $('<tr>');
        if((j===config.serial[i].entries-1))
          row.addClass('result');
        $('#table').append(row);

        if (j===config.serial[i].entries-1)
          row.append($('<td>'+config.serial[i].name+ '</td>'));
        else
          row.append($('<td>'));
        row.append($('<td>').html(j+1));
        row.append($('<td>').attr('id', config.serial[i].name+'time'+j));
        row.append($('<td>').attr('id', config.serial[i].name+'entry'+j));
        if (j===config.serial[i].entries-2 && config.serial[i].average)
          row.append($('<td>').html( 'Average' ));
        if (j===config.serial[i].entries-1 && config.serial[i].average)
          row.append($('<td>').attr('id', config.serial[i].name + 'avg'));
      }
    }

    var socket = io();
    socket.on('entry', function(msg){
      for(var i = 0; i<config.serial.length; i++)
        if (msg.name===config.serial[i].name)
          break;  //store value of i for correct serial entry

      for(var j = 0; j<config.serial[i].entries; j++){
        if (j<config.serial[i].entries-1){
          $('#' + config.serial[i].name+'time'+j).html($('#' + config.serial[i].name+'time'+(j + 1)).html());
          $('#' + config.serial[i].name+'entry'+j).html($('#' + config.serial[i].name+'entry'+(j + 1)).html());
        }
        else{
          $('#' + config.serial[i].name+'time'+j).html(printTime());
          $('#' + config.serial[i].name+'entry'+j).html(msg.entry);
        }
      }
    });

    socket.on('average', function(msg){
      for(var i = 0; i<config.serial.length; i++)
        if (msg.name===config.serial[i].name){
          console.log(config.serial[i].name+'avg');
          $('#' + config.serial[i].name+'avg').html(Math.round(msg.entry*1000)/1000);
        }
    });

    socket.on('ip', function(msg){
      $('#headerip').html(msg);
    });

  </script>
</body>
</html>