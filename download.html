<!doctype html>
<html>
<head>
  <title>MBDCcomUnit</title>
   <style>
      *{font-size: 25px; padding:0; margin: 0; }
      div {position: relative; margin: auto; margin-top: 50px; width: 80%;}
      ul { list-style-type: none; overflow: hidden;}
      input[type="button"] {float: right; font-size: 20px;}
    </style>
</head>
<body>
  <div >
    <ul id="content">
    </ul>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/res/jquery-1.11.1.js"></script>
  <script type="text/javascript">
    var fileList;
    var socket = io();

    function downloadFile(index){
      window.location.href = '/download?file='+fileList[index];
    }

    function deleteFile(index){
      if (confirm("Do you really want to delete "+fileList[index]+"?")){
        socket.emit('deleteLog', fileList[index]);
        socket.emit('getLogList');
      }
    }

    function uploadFile(index){
      if (confirm("Do you really want to upload "+fileList[index]+"?")){
        socket.emit('uploadLog', fileList[index]);
      }
    }

    function goDebug(){
      window.location.href = '/';
    }

    socket.emit('getLogList');

    socket.on('logList', function(list){
      fileList = list;

      $('#content').contents().remove();
      if (list.length==0){
        $('#content').append($('<li>').append('No files found'));
      }
      else{
        list.forEach((element, index) => {
          let newItem = $('<li>').append('<span>'+element+'</span>')
            .append('<input type="button" value="Upload" onclick="javascript:uploadFile('+index+')">')
            .append('<input type="button" value="Download" onclick="javascript:downloadFile('+index+')">')
            .append('<input type="button" value="Delete" onclick="javascript:deleteFile('+index+')">');
          $('#content').append(newItem);
        });
      }

      let newItem = $('<li>')
        .append('<input type="button" value="Cancel" onclick="javascript:goDebug()">');
      $('#content').append(newItem);
      
    });

    socket.on('uploadLogResponse', (response)=>{
      alert(response);
    });
  </script>
</body>
</html>